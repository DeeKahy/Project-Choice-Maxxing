{% extends "base.html" %}
{% block title %}Results: {{ poll.title }}{% endblock %}
{% block content %}
<h1>{{ poll.title }}</h1>
{% if poll.description %}<p class="text-muted">{{ poll.description }}</p>{% endif %}

<p class="text-muted mb-1">{{ votes|length }} vote{{ 's' if votes|length != 1 else '' }} cast</p>

{% if results %}
<!-- Score Voting -->
<div class="card">
    <h3>Score Voting</h3>
    <p class="text-muted" style="font-size: 0.875rem">Sum of all scores</p>
    {% for name, score in results.score_voting %}
    <div class="result-row">
        <span class="result-rank">{{ loop.index }}</span>
        <span style="flex: 1">{{ name }}</span>
        <span><strong>{{ score }}</strong> pts</span>
    </div>
    {% endfor %}
</div>

<!-- Schulze -->
<div class="card">
    <h3>Schulze Method</h3>
    <p class="text-muted" style="font-size: 0.875rem">Beatpath winner</p>
    {% for name, wins in results.schulze_method %}
    <div class="result-row">
        <span class="result-rank">{{ loop.index }}</span>
        <span style="flex: 1">{{ name }}</span>
        <span><strong>{{ wins }}</strong> wins</span>
    </div>
    {% endfor %}
</div>

<!-- Borda Count Voting -->
<div class="card">
    <h3>Schulze Method</h3>
    <p class="text-muted" style="font-size: 0.875rem">Sum of all scores</p>
    {% for name, wins in results.borda_count %}
    <div class="result-row">
        <span class="result-rank">{{ loop.index }}</span>
        <span style="flex: 1">{{ name }}</span>
        <span><strong>{{ scores }}</strong> Scores</span>
    </div>
    {% endfor %}
</div>

<!-- STAR VOTING -->
<div class="card">
    <h3>STAR Voting</h3>
    <p class="text-muted" style="font-size: 0.875rem">Runoff winner</p>
    {% for name, wins in results.star_voting %}
    <div class="result-row">
        <span class="result-rank">{{ loop.index }}</span>
        <span style="flex: 1">{{ name }}</span>
        <span><strong>{{ wins }}</strong> runoff wins</span>
    </div>
    {% endfor %}
</div>

<!-- Kemeny Young -->
<div class="card">
    <h3>Kemeny-Young Method</h3>
    <p class="text-muted" style="font-size: 0.875rem">Optimal excluding subset cost</p>
    {% for name, cost in results.kemeny_young %}
    <div class="result-row">
        <span class="result-rank">{{ loop.index }}</span>
        <span style="flex: 1">{{ name }}</span>
        <span><strong>{{ cost }}</strong> cost </span>
    </div>
    {% endfor %}
</div>

{% else %}
<div class="card">
    <p class="text-muted" style="text-align: center;">No votes yet. Results will appear once voting begins.</p>
</div>
{% endif %}

<div class="mt-1">
    {% if poll.is_open == "true" %}
        <a href="{{ url_for('vote', poll_id=poll.id) }}" class="btn btn-block">Vote on this poll</a>
    {% else %}
        <button class="btn btn-block btn-disabled" disabled>Poll Closed</button>
    {% endif %}
</div>
{% endblock %}
